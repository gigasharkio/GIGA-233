{"ast":null,"code":"import _regeneratorRuntime from \"/root/gshark/Three.js/Gigashark-v2/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/root/gshark/Three.js/Gigashark-v2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/root/gshark/Three.js/Gigashark-v2/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/root/gshark/Three.js/Gigashark-v2/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { setAPIKey as _setAPIKey, setEmbedHost as _setEmbedHost, post } from '@toruslabs/http-helpers';\nimport stringify from 'json-stable-stringify';\nimport { ec as ec$1 } from 'elliptic';\nimport createKeccakHash from 'keccak';\nimport { encrypt, getPublic, decrypt } from '@toruslabs/eccrypto';\n\nfunction keccak256(a) {\n  return createKeccakHash(\"keccak256\").update(a).digest();\n}\n\nvar ec = new ec$1(\"secp256k1\");\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nvar MetadataStorageLayer = /*#__PURE__*/function () {\n  // ms\n  function MetadataStorageLayer() {\n    _classCallCheck(this, MetadataStorageLayer);\n\n    var metadataHost = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"https://metadata.tor.us\";\n    var serverTimeOffset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n    _defineProperty(this, \"metadataHost\", void 0);\n\n    _defineProperty(this, \"serverTimeOffset\", void 0);\n\n    this.metadataHost = metadataHost;\n    this.serverTimeOffset = serverTimeOffset;\n  }\n\n  _createClass(MetadataStorageLayer, [{\n    key: \"generateMetadataParams\",\n    value: function generateMetadataParams(message, privateKeyHex) {\n      var _ref, _sig$recoveryParam;\n\n      var key = ec.keyFromPrivate(privateKeyHex, \"hex\");\n      var setData = {\n        data: message,\n        timestamp: Math.floor(this.serverTimeOffset + Date.now() / 1000).toString(16)\n      };\n      var sig = key.sign(keccak256(stringify(setData)));\n      return {\n        pub_key_X: key.getPublic().getX().toString(\"hex\"),\n        pub_key_Y: key.getPublic().getY().toString(\"hex\"),\n        set_data: setData,\n        signature: Buffer.from((_ref = sig.r.toString(16, 64) + sig.s.toString(16, 64) + ((_sig$recoveryParam = sig.recoveryParam) === null || _sig$recoveryParam === void 0 ? void 0 : _sig$recoveryParam.toString(16).padStart(2, \"0\").slice(-2))) !== null && _ref !== void 0 ? _ref : \"00\", \"hex\").toString(\"base64\")\n      };\n    }\n  }, {\n    key: \"generatePubKeyParams\",\n    value: function generatePubKeyParams(privateKeyHex) {\n      var key = ec.keyFromPrivate(privateKeyHex, \"hex\");\n      return {\n        pub_key_X: key.getPublic().getX().toString(\"hex\"),\n        pub_key_Y: key.getPublic().getY().toString(\"hex\")\n      };\n    }\n  }, {\n    key: \"setMetadata\",\n    value: function () {\n      var _setMetadata = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(data, namespace, options) {\n        var params, metadataResponse;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                params = namespace !== null ? _objectSpread(_objectSpread({}, data), {}, {\n                  namespace: namespace\n                }) : data;\n                _context.next = 3;\n                return post(\"\".concat(this.metadataHost, \"/set\"), params, options, {\n                  useAPIKey: true\n                });\n\n              case 3:\n                metadataResponse = _context.sent;\n                return _context.abrupt(\"return\", metadataResponse.message);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function setMetadata(_x, _x2, _x3) {\n        return _setMetadata.apply(this, arguments);\n      }\n\n      return setMetadata;\n    }()\n  }, {\n    key: \"getMetadata\",\n    value: function () {\n      var _getMetadata = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(pubKey, namespace, options) {\n        var params, metadataResponse;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                params = namespace !== null ? _objectSpread(_objectSpread({}, pubKey), {}, {\n                  namespace: namespace\n                }) : pubKey;\n                _context2.next = 3;\n                return post(\"\".concat(this.metadataHost, \"/get\"), params, options, {\n                  useAPIKey: true\n                });\n\n              case 3:\n                metadataResponse = _context2.sent;\n                return _context2.abrupt(\"return\", metadataResponse.message);\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getMetadata(_x4, _x5, _x6) {\n        return _getMetadata.apply(this, arguments);\n      }\n\n      return getMetadata;\n    }()\n  }], [{\n    key: \"setAPIKey\",\n    value: function setAPIKey(apiKey) {\n      _setAPIKey(apiKey);\n    }\n  }, {\n    key: \"setEmbedHost\",\n    value: function setEmbedHost(embedHost) {\n      _setEmbedHost(embedHost);\n    }\n  }]);\n\n  return MetadataStorageLayer;\n}();\n\nvar WEBAUTHN_TORUS_SHARE = \"webauthn_torus_share\";\nvar WEBAUTHN_DEVICE_SHARE = \"webauthn_device_share\";\n\nfunction encParamsHexToBuf(encParamsHex) {\n  return {\n    iv: Buffer.from(encParamsHex.iv, \"hex\"),\n    ephemPublicKey: Buffer.from(encParamsHex.ephemPublicKey, \"hex\"),\n    ciphertext: Buffer.from(encParamsHex.ciphertext, \"hex\"),\n    mac: Buffer.from(encParamsHex.mac, \"hex\")\n  };\n}\n\nfunction encParamsBufToHex(encParams) {\n  return {\n    iv: Buffer.from(encParams.iv).toString(\"hex\"),\n    ephemPublicKey: Buffer.from(encParams.ephemPublicKey).toString(\"hex\"),\n    ciphertext: Buffer.from(encParams.ciphertext).toString(\"hex\"),\n    mac: Buffer.from(encParams.mac).toString(\"hex\")\n  };\n}\n\nfunction encryptData(_x7, _x8) {\n  return _encryptData.apply(this, arguments);\n}\n\nfunction _encryptData() {\n  _encryptData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(privKeyHex, d) {\n    var serializedDec, serializedBuf, encParams, encParamsHex, sData;\n    return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            serializedDec = JSON.stringify(d);\n            serializedBuf = Buffer.from(serializedDec, \"utf-8\");\n            _context3.next = 4;\n            return encrypt(getPublic(Buffer.from(privKeyHex, \"hex\")), serializedBuf);\n\n          case 4:\n            encParams = _context3.sent;\n            encParamsHex = encParamsBufToHex(encParams);\n            sData = JSON.stringify(encParamsHex);\n            return _context3.abrupt(\"return\", sData);\n\n          case 8:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _encryptData.apply(this, arguments);\n}\n\nfunction decryptData(_x9, _x10) {\n  return _decryptData.apply(this, arguments);\n}\n\nfunction _decryptData() {\n  _decryptData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(privKeyHex, d) {\n    var encParamsHex, encParams, keyPair, serializedBuf, serializedDec, data;\n    return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            encParamsHex = JSON.parse(d);\n            encParams = encParamsHexToBuf(encParamsHex);\n            keyPair = ec.keyFromPrivate(privKeyHex);\n            _context4.next = 5;\n            return decrypt(Buffer.from(keyPair.getPrivate().toString(\"hex\", 64), \"hex\"), encParams);\n\n          case 5:\n            serializedBuf = _context4.sent;\n            serializedDec = serializedBuf.toString(\"utf-8\");\n            data = JSON.parse(serializedDec);\n            return _context4.abrupt(\"return\", data);\n\n          case 9:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n  return _decryptData.apply(this, arguments);\n}\n\nfunction getAndDecryptData(_x11, _x12, _x13) {\n  return _getAndDecryptData.apply(this, arguments);\n}\n\nfunction _getAndDecryptData() {\n  _getAndDecryptData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(m, privKeyHex, namespace) {\n    var keyPair, pubKey, serializedData, data;\n    return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            keyPair = ec.keyFromPrivate(privKeyHex);\n            pubKey = keyPair.getPublic();\n            _context5.next = 4;\n            return m.getMetadata({\n              pub_key_X: pubKey.getX().toString(16),\n              pub_key_Y: pubKey.getY().toString(16)\n            }, namespace);\n\n          case 4:\n            serializedData = _context5.sent;\n\n            if (serializedData) {\n              _context5.next = 7;\n              break;\n            }\n\n            return _context5.abrupt(\"return\", null);\n\n          case 7:\n            _context5.next = 9;\n            return decryptData(privKeyHex, serializedData);\n\n          case 9:\n            data = _context5.sent;\n            return _context5.abrupt(\"return\", data);\n\n          case 11:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n  return _getAndDecryptData.apply(this, arguments);\n}\n\nfunction encryptAndSetData(_x14, _x15, _x16, _x17) {\n  return _encryptAndSetData.apply(this, arguments);\n}\n\nfunction _encryptAndSetData() {\n  _encryptAndSetData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6(m, privKeyHex, d, namespace) {\n    var sData, metadataParams;\n    return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.next = 2;\n            return encryptData(privKeyHex, d);\n\n          case 2:\n            sData = _context6.sent;\n            metadataParams = m.generateMetadataParams(sData, privKeyHex);\n            _context6.next = 6;\n            return m.setMetadata(metadataParams, namespace);\n\n          case 6:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n  return _encryptAndSetData.apply(this, arguments);\n}\n\nfunction setTorusShare(_x18, _x19, _x20, _x21, _x22) {\n  return _setTorusShare.apply(this, arguments);\n}\n\nfunction _setTorusShare() {\n  _setTorusShare = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7(m, webAuthnPubKey, webAuthnRefHex, subspace, subspaceData) {\n    var refKeyPair, privKey, pubKey, data, d, serializedSubspaceData, serializedSubspaceDataBuf, encSubspaceData, encSubspaceDataHex;\n    return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            refKeyPair = ec.keyFromPrivate(webAuthnRefHex);\n            privKey = refKeyPair.getPrivate();\n            pubKey = ec.keyFromPublic({\n              x: webAuthnPubKey.pub_key_X,\n              y: webAuthnPubKey.pub_key_Y\n            });\n            _context7.next = 5;\n            return getAndDecryptData(m, webAuthnRefHex, WEBAUTHN_TORUS_SHARE);\n\n          case 5:\n            data = _context7.sent;\n            d = {};\n            if (data) d = data;\n            serializedSubspaceData = JSON.stringify(subspaceData);\n            serializedSubspaceDataBuf = Buffer.from(serializedSubspaceData, \"utf-8\");\n            _context7.next = 12;\n            return encrypt(Buffer.from(pubKey.getPublic(\"hex\"), \"hex\"), serializedSubspaceDataBuf);\n\n          case 12:\n            encSubspaceData = _context7.sent;\n            encSubspaceDataHex = encParamsBufToHex(encSubspaceData);\n            d[subspace] = encSubspaceDataHex;\n            _context7.next = 17;\n            return encryptAndSetData(m, privKey.toString(\"hex\", 64), d, WEBAUTHN_TORUS_SHARE);\n\n          case 17:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7);\n  }));\n  return _setTorusShare.apply(this, arguments);\n}\n\nfunction setDeviceShare(_x23, _x24, _x25, _x26) {\n  return _setDeviceShare.apply(this, arguments);\n}\n\nfunction _setDeviceShare() {\n  _setDeviceShare = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(m, webAuthnRefHex, subspace, subspaceData) {\n    var keyPair, privKey, data, d;\n    return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            keyPair = ec.keyFromPrivate(webAuthnRefHex);\n            privKey = keyPair.getPrivate();\n            _context8.next = 4;\n            return getAndDecryptData(m, webAuthnRefHex, WEBAUTHN_DEVICE_SHARE);\n\n          case 4:\n            data = _context8.sent;\n            d = {};\n            if (data) d = data;\n            d[subspace] = subspaceData;\n            _context8.next = 10;\n            return encryptAndSetData(m, privKey.toString(\"hex\", 64), d, WEBAUTHN_DEVICE_SHARE);\n\n          case 10:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, _callee8);\n  }));\n  return _setDeviceShare.apply(this, arguments);\n}\n\nfunction getTorusShare(_x27, _x28, _x29, _x30) {\n  return _getTorusShare.apply(this, arguments);\n}\n\nfunction _getTorusShare() {\n  _getTorusShare = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9(m, webAuthnKeyHex, webAuthnRefHex, subspace) {\n    var data, encParamsHex, encParams, keyPair, privKey, serializedSubspaceDataBuf, serializedSubspaceData, subspaceData;\n    return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n      while (1) {\n        switch (_context9.prev = _context9.next) {\n          case 0:\n            _context9.next = 2;\n            return getAndDecryptData(m, webAuthnRefHex, WEBAUTHN_TORUS_SHARE);\n\n          case 2:\n            data = _context9.sent;\n\n            if (data) {\n              _context9.next = 5;\n              break;\n            }\n\n            return _context9.abrupt(\"return\", null);\n\n          case 5:\n            encParamsHex = data[subspace];\n\n            if (encParamsHex) {\n              _context9.next = 8;\n              break;\n            }\n\n            return _context9.abrupt(\"return\", null);\n\n          case 8:\n            encParams = encParamsHexToBuf(encParamsHex);\n            keyPair = ec.keyFromPrivate(webAuthnKeyHex);\n            privKey = keyPair.getPrivate();\n            _context9.next = 13;\n            return decrypt(Buffer.from(privKey.toString(\"hex\", 64), \"hex\"), encParams);\n\n          case 13:\n            serializedSubspaceDataBuf = _context9.sent;\n            serializedSubspaceData = serializedSubspaceDataBuf.toString(\"utf-8\");\n            subspaceData = JSON.parse(serializedSubspaceData);\n            return _context9.abrupt(\"return\", subspaceData);\n\n          case 17:\n          case \"end\":\n            return _context9.stop();\n        }\n      }\n    }, _callee9);\n  }));\n  return _getTorusShare.apply(this, arguments);\n}\n\nfunction getDeviceShare(_x31, _x32, _x33) {\n  return _getDeviceShare.apply(this, arguments);\n}\n\nfunction _getDeviceShare() {\n  _getDeviceShare = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(m, webAuthnRefHex, subspace) {\n    var data;\n    return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n      while (1) {\n        switch (_context10.prev = _context10.next) {\n          case 0:\n            _context10.next = 2;\n            return getAndDecryptData(m, webAuthnRefHex, WEBAUTHN_DEVICE_SHARE);\n\n          case 2:\n            data = _context10.sent;\n\n            if (!data) {\n              _context10.next = 5;\n              break;\n            }\n\n            return _context10.abrupt(\"return\", data[subspace]);\n\n          case 5:\n            return _context10.abrupt(\"return\", null);\n\n          case 6:\n          case \"end\":\n            return _context10.stop();\n        }\n      }\n    }, _callee10);\n  }));\n  return _getDeviceShare.apply(this, arguments);\n}\n\nexport { decryptData, MetadataStorageLayer as default, ec, encParamsBufToHex, encParamsHexToBuf, encryptAndSetData, encryptData, getAndDecryptData, getDeviceShare, getTorusShare, keccak256, setDeviceShare, setTorusShare };","map":{"version":3,"mappings":"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","names":["keccak256","a","createKeccakHash","update","digest","ec","EC","MetadataStorageLayer","constructor","metadataHost","serverTimeOffset","_defineProperty","generateMetadataParams","message","privateKeyHex","key","keyFromPrivate","setData","data","timestamp","Math","floor","Date","now","toString","sig","sign","stringify","pub_key_X","getPublic","getX","pub_key_Y","getY","set_data","signature","Buffer","from","r","s","recoveryParam","_sig$recoveryParam","padStart","slice","generatePubKeyParams","namespace","options","params","post","useAPIKey","metadataResponse","pubKey","apiKey","setAPIKey","embedHost","setEmbedHost","WEBAUTHN_TORUS_SHARE","WEBAUTHN_DEVICE_SHARE","encParamsHexToBuf","encParamsHex","iv","ephemPublicKey","ciphertext","mac","encParamsBufToHex","encParams","encryptData","privKeyHex","d","serializedDec","JSON","serializedBuf","encrypt","sData","decryptData","parse","keyPair","decrypt","getPrivate","getAndDecryptData","m","getMetadata","serializedData","encryptAndSetData","metadataParams","setMetadata","setTorusShare","webAuthnPubKey","webAuthnRefHex","subspace","subspaceData","refKeyPair","privKey","keyFromPublic","x","y","serializedSubspaceData","serializedSubspaceDataBuf","encSubspaceData","encSubspaceDataHex","setDeviceShare","getTorusShare","webAuthnKeyHex","getDeviceShare"],"sources":["../src/utils.ts","../src/MetadataStorageLayer.ts","../src/webAuthnShareResolver.ts"],"sourcesContent":[null,null,null]},"metadata":{},"sourceType":"module"}